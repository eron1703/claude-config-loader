# Server and Infrastructure Information
#
# Document all servers, VMs, and infrastructure resources

servers:
  # Example structure - customize for your environment
  # production_api:
  #   host: api.example.com
  #   ip: 192.168.1.100
  #   purpose: "Production API server"
  #   access: "SSH via bastion"
  #   credentials: "See 1Password: Production Servers"
  #
  # staging_api:
  #   host: staging-api.example.com
  #   ip: 192.168.1.101
  #   purpose: "Staging environment"
  #   access: "Direct SSH"
  #   credentials: "See 1Password: Staging"

  localhost:
    host: localhost
    ip: 127.0.0.1
    purpose: "Local development environment"
    access: "Direct"
    platform: "macOS with OrbStack"
    docker: "OrbStack (NOT Docker Desktop)"
    workspace: "~/projects/"
    notes: |
      - All development happens locally via Docker/OrbStack
      - Multiple users/agents work in parallel
      - NEVER shut down OrbStack service globally
      - Only manage individual containers

  dev-server:
    host: demo-server
    ip: 65.21.153.235
    purpose: "PRIMARY DEV SERVER — CI/CD develop branches auto-deploy here, GitLab Runner lives here"
    access: "SSH: demo-server (root, key: ~/.ssh/demo_server)"
    platform: "Linux (K3S Kubernetes + Docker)"
    credentials: "See GitLab CI/CD Variables: SSH_PRIVATE_KEY, DEV_SERVER"
    ci_cd_role: "DEV environment — develop branch auto-deploy target"
    infrastructure:
      kubernetes: "K3S v1.34.3 (monitoring namespace: Grafana, Prometheus, Loki)"
      docker: "Docker containers for FlowMaster microservices and other services"
      reverse_proxy: "Nginx on port 80"
      monitoring: "Grafana (port 30080), Prometheus, Loki stack"
      ci_cd: "GitLab Runner (flowmaster-demo-runner, docker executor, tags: docker/demo-server)"
    flowmaster_deployments:
      rebuild:
        path: "/opt/flowmaster-rebuild/"
        description: "Main FlowMaster microservices development"
        services:
          - "flowmaster-frontend-nextjs:9009"
          - "flowmaster-api-gateway-service:9000"
          - "flowmaster-auth-service:9001"
          - "flowmaster-document-intelligence-service:9002"
          - "flowmaster-process-design-service:9003"
          - "flowmaster-event-bus-service (restarting)"
          - "flowmaster-execution-engine-service (restarting)"
          - "flowmaster-human-task-service:9006"
          - "flowmaster-ai-agent-service:9007"
          - "flowmaster-scheduling-service:9008"
          - "flowmaster-websocket-gateway-service:9010"
          - "flowmaster-notification-service:9011"
          - "flowmaster-auth-db:5433 (PostgreSQL)"
          - "flowmaster-auth-redis:6380"
      engage:
        path: "/opt/flowmaster-engage/"
        repo: "gitlab.com/flow-master/flowmaster-engage"
        description: "FlowMaster Engage project"
      manager:
        path: "/opt/flowmaster-manager/"
        description: "FlowMaster management tools"
      tests:
        path: "/opt/flowmaster-tests/"
        description: "FlowMaster testing infrastructure"
      deployments:
        path: "/opt/flowmaster-deployments/"
        description: "Deployment scripts and configurations"
    other_services:
      - "arangodb-main:8529 (shared: Engage, SDX)"
      - "sdx-mcp-server:8011 (Plane MCP Server - 40 tools)"
      - "sdx-backend:8010"
      - "sdx-frontend:3010"
      - "plane-web:8083 (Plane Frontend Web UI)"
      - "plane-api:8012 (Plane MCP Server)"
    open_ports:
      - "80 (Nginx reverse proxy)"
      - "9000-9011 (FlowMaster microservices)"
      - "30080 (Grafana monitoring)"
      - "8010-8012 (SDX services)"
      - "8529 (ArangoDB)"
      - "8083 (Plane Web UI)"
      - "5433 (FlowMaster Auth DB)"
      - "6380 (FlowMaster Auth Redis)"
    hetzner_firewall:
      enabled: true
      note: "Server uses Hetzner Cloud Firewall for network security"
      external_access: "Ports must be opened in Hetzner Cloud Firewall for external access"
      management: "Configure via Hetzner Cloud Console or API"
      current_rules:
        - "Port 80 (HTTP) - Open"
        - "Port 22 (SSH) - Open"
        - "Port 8000-8083 (Application ports) - Configure as needed"
    connection:
      user_ben:
        host: demo-server
        hostname: 65.21.153.235
        user: ben
        port: 22
        identity_file: ~/.ssh/ben_demo
        connect: "ssh demo-server"
      user_root:
        host: demo-server-root
        hostname: 65.21.153.235
        user: root
        port: 22
        identity_file: ~/.ssh/id_ed25519_demo
        connect: "ssh demo-server-root"
      ci_cd_deploy:
        hostname: 65.21.153.235
        user: root
        port: 22
        key_type: ED25519
        identity: "gitlab-ci-deploy"
        credentials: "GitLab CI/CD: SSH_PRIVATE_KEY"
    mcp_server:
      name: "SDX MCP Server"
      container: "sdx-mcp-server"
      port: 8011
      status: "Running (up 7+ days)"
      health_endpoint: "http://localhost:8011/health"
      tools_loaded: 40
      pillars:
        - "Admin (11 tools)"
        - "Ingest (10 tools)"
        - "Discovery (9 tools)"
        - "Data Router (10 tools)"
      connections:
        primary_database:
          type: "ArangoDB"
          container: "arangodb-main"
          port: 8529
          database: "sdx"
          collections: 17
          credentials: "See GitLab CI/CD or /opt/sdx/backend/.env"
        ai_services:
          - "OpenAI API (embeddings: text-embedding-3-small)"
          - "OpenRouter API (LLM annotations)"
        data_sources:
          - "PostgreSQL (primary, fully implemented)"
          - "MySQL (configured, not implemented)"
          - "Oracle (configured, not implemented)"
          - "SQL Server (configured, not implemented)"
          - "MongoDB (configured, not implemented)"
        webhooks:
          method: "HTTP POST"
          authentication: "HMAC-SHA256"
          retry_policy: "3 retries with exponential backoff"
      documentation:
        location: "~/projects/plane-mcp-server/"
        files:
          - "README_INVESTIGATION.md"
          - "INVESTIGATION_SUMMARY.md"
          - "CONNECTIONS_QUICK_REFERENCE.md"
          - "SDX_MCP_SERVER_INVESTIGATION.md"
          - "ARCHITECTURE_DIAGRAM.md"
    plane_status:
      main_app: "DEPLOYED"
      version: "Plane CE v1.2.1"
      deployment_path: "/opt/plane/"
      deployment_method: "Docker Compose"
      web_ui:
        url: "http://65.21.153.235:8083"
        port: 8083
      mcp_server:
        status: "RUNNING"
        url: "http://65.21.153.235:8012"
        port: 8012
        deployment_path: "/opt/plane-mcp-server/"
      containers:
        count: 13
        services:
          - "plane-web (Frontend Web UI)"
          - "plane-admin (Admin Panel)"
          - "plane-space (Public Space)"
          - "plane-api (Backend API)"
          - "plane-worker (Background Worker)"
          - "plane-beat-worker (Celery Beat Scheduler)"
          - "plane-live (Real-time Service)"
          - "plane-proxy (Nginx Reverse Proxy)"
          - "plane-db (PostgreSQL Database)"
          - "plane-redis (Redis Cache)"
          - "plane-mq (RabbitMQ Message Queue)"
          - "plane-minio (MinIO Object Storage)"
          - "plane-mcp-server (MCP Integration)"
      admin_user: "admin@flowmaster.dev"
      workspace:
        name: "flowmaster"
        project: "FM (FlowMaster)"
      api_key: "plane_api_b91c8c1ffd1448d0bd0130bbc279b124"
      users:
        - "admin@flowmaster.dev"
        - "benjamin@flowmaster.dev"
        - "irtiza.s2918@gmail.com"
        - "muhammadsadiqrajani@gmail.com"
        - "ar.raza5092@gmail.com"
    monitoring:
      grafana:
        url: "http://65.21.153.235:30080"
        port: 30080
        deployment: "Kubernetes (monitoring namespace)"
        service: "grafana (NodePort)"
        access: "Browser - no auth required for viewing"
      prometheus:
        deployment: "Kubernetes (monitoring namespace)"
        service: "prometheus-grafana"
      loki:
        deployment: "Kubernetes (monitoring namespace)"
        purpose: "Log aggregation"
    notes: |
      - PRIMARY DEV SERVER — CI/CD develop branches auto-deploy here
      - GitLab Runner (flowmaster-demo-runner) runs here
      - SSH: demo-server or demo (root, key: ~/.ssh/demo_server)
      - Grafana monitoring: http://65.21.153.235:30080
      - Plane project management: http://65.21.153.235:8083
      - Agent telemetry: http://65.21.153.235:8099
      - K3S for monitoring stack, Docker for application services
      - FlowMaster microservices on ports 9000-9011
      - All new projects deploy develop branch here

  staging-server:
    host: ms-dev
    ip: 91.98.159.56
    purpose: "STAGING SERVER — staging branches auto-deploy here"
    access: "SSH: ms-dev (root, key: ~/.ssh/id_rsa)"
    platform: "Ubuntu Server"
    credentials: "GitLab CI/CD Variables: SSH_PRIVATE_KEY, STAGING_SERVER"
    ci_cd_role: "STAGING environment — staging branch auto-deploy target"
    infrastructure:
      runtime: "Docker + Docker Compose"
      web_server: "Nginx (reverse proxy + SSL termination via Let's Encrypt)"
      gitlab_runner: "NONE — runner is on dev server (65.21.153.235)"
    deployments:
      staging:
        path: "/opt/<project>-staging/"
        branch: "staging"
        trigger: "Auto-deploy on push to staging branch"
        domain: "staging.flow-master.ai"
        compose_file: "docker-compose.integration.yml"
    existing_dirs:
      - "/opt/flowmaster-microservices-develop/"
      - "/opt/flowmaster-microservices-staging/"
      - "/opt/flowmaster-frontend/"
      - "/opt/test-rig/"
    connection:
      user_root:
        hostname: 91.98.159.56
        user: root
        port: 22
        key: "~/.ssh/id_rsa"
        ssh_alias: "ms-dev"
    notes: |
      - STAGING ENVIRONMENT — staging branches auto-deploy here
      - Docker Compose for deployments
      - SSL via Let's Encrypt / certbot
      - GitLab CI variable: STAGING_SERVER=91.98.159.56

  production-server:
    host: server
    ip: 91.99.237.14
    purpose: "PRODUCTION SERVER — main branch manual deploy only"
    access: "SSH: server (ben) or root-server (root), key: ~/.ssh/eron1703_duckdns"
    platform: "Ubuntu Server"
    credentials: "GitLab CI/CD Variables: SSH_PRIVATE_KEY, PRODUCTION_SERVER"
    ci_cd_role: "PRODUCTION environment — main branch manual deploy only"
    infrastructure:
      runtime: "Docker + Docker Compose"
      web_server: "Nginx (reverse proxy + SSL termination via Let's Encrypt)"
      other: "Dokku, Portainer (9443)"
      gitlab_runner: "NONE — runner is on dev server (65.21.153.235)"
    deployments:
      production:
        path: "/opt/<project>/"
        branch: "main"
        trigger: "MANUAL trigger only (when: manual in GitLab CI)"
        domain: "app.flow-master.ai"
        compose_file: "docker-compose.integration.yml"
    connection:
      user_ben:
        hostname: 91.99.237.14
        user: ben
        port: 22
        key: "~/.ssh/eron1703_duckdns"
        ssh_alias: "server"
      user_root:
        hostname: 91.99.237.14
        user: root
        port: 22
        key: "~/.ssh/eron1703_duckdns"
        ssh_alias: "root-server"
    notes: |
      - PRODUCTION ENVIRONMENT — main branch manual deploy only
      - Also used as personal dev server for manual SSH work
      - Projects dir for manual work: /srv/projects/
      - Docker Compose for deployments
      - SSL via Let's Encrypt / certbot
      - GitLab CI variable: PRODUCTION_SERVER=91.99.237.14

# Cloud Resources
cloud:
  # aws:
  #   account_id: "123456789012"
  #   region: us-east-1
  #   resources:
  #     - EC2 instances
  #     - RDS databases
  #     - S3 buckets
  #   credentials: "AWS CLI configured with profile 'default'"

# Access Patterns
access:
  # bastion:
  #   host: bastion.example.com
  #   purpose: "Jump host for production access"
  #   credentials: "SSH key in ~/.ssh/bastion_key"

# Notes
notes:
  - "Never store passwords in this file"
  - "Use references to password managers (1Password, LastPass, etc.)"
  - "Update this file when infrastructure changes"
